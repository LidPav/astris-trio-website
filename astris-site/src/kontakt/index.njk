---
layout: layout.njk
title: Kontakt
description: Booking & Kontakt
---

<h1 class="h1">Kontakt</h1>
<p class="lead">Für Konzertanfragen, Programme und Pressematerial freuen wir uns über eine Nachricht.</p>

<div class="grid">

  <!-- Karte 1: Kontakt / E-Mail -->
  <div class="card">
    <h2 class="h2">Kontakt</h2>
    <p class="small">
      E‑Mail:
      mailto:{{ site.email | replace(
        {{ site.email }}
      </a>
    </p>
  </div>

  <!-- Karte 2: Kontaktformular (AJAX + Formspree) -->
  <div class="card">
    <h2 class="h2">Kontaktformular</h2>

    https://formspree.io/f/meelkjon" data-ajax="true" accept-charset="UTF-8">

      <!-- Zeit-basierte Spam-Erkennung -->
      <input type="hidden" id="form_start_time" name="form_start_time" value="">

      <!-- Honeypot (unsichtbar für echte Nutzer) -->
      <p class="visually-hidden" aria-hidden="true">
        <label for="website">Website (leer lassen)</label>
        <input id="website" name="website" type="text" tabindex="-1" autocomplete="off" />
      </p>

      <div class="form-row">
        <label for="name">Name<span aria-hidden="true">*</span></label>
        <input id="name" name="name" type="text" required autocomplete="name" placeholder="Ihr Name" aria-required="true" />
      </div>

      <div class="form-row">
        <label for="email">E‑Mail<span aria-hidden="true">*</span></label>
        <input id="email" name="email" type="email" required autocomplete="email" placeholder="name@example.com" aria-required="true" />
      </div>

      <div class="form-row">
        <label for="subject">Betreff</label>
        <input id="subject" name="subject" type="text" placeholder="Betreff (optional)" />
      </div>

      <div class="form-row">
        <label for="message">Nachricht<span aria-hidden="true">*</span></label>
        <textarea id="message" name="message" rows="6" required placeholder="Ihre Nachricht" aria-required="true"></textarea>
      </div>

      <!-- Formspree Meta -->
      <input type="hidden" name="_subject" value="Kontakt Astris Trio">
      <input type="hidden" name="_language" value="de">

      <!-- Kein Redirect – Erfolgsmeldung bleibt auf Seite -->
      <!-- <input type="hidden" name="_next" value="/danke/"> -->

      <button type="submit" class="btn">Nachricht senden</button>

      <!-- Inline-Status für Erfolg/Fehler -->
      <p id="form-status" class="small" role="status" aria-live="polite" style="margin-top:.5rem;"></p>

      <p class="form-privacy small">
        Mit dem Absenden stimmen Sie zu, dass wir Ihre Angaben zur Beantwortung Ihrer Anfrage verarbeiten.
        Details in unserer <a href="/datenschutz/">Datenschutzerklärung</a>.
      </p>

    </form>
  </div>

</div> <!-- /grid -->


<!-- JAVASCRIPT: AJAX + Honeypot + Zeitbasierte Erkennung -->
<script>
// Zeitstempel setzen, wenn die Seite geladen ist
window.addEventListener("DOMContentLoaded", function () {
  const startField = document.getElementById("form_start_time");
  if (startField) startField.value = Date.now();
});

// AJAX-Submit + Spam-Prüfungen
document.addEventListener("submit", async function (e) {
  const form = e.target;
  if (!form.matches('form[data-ajax="true"]')) return; // Nur dieses Formular

  // Browser-Validierung
  if (!form.checkValidity()) return;

  // Honeypot
  const honeypot = form.querySelector('input[name="website"]');
  if (honeypot && honeypot.value) {
    e.preventDefault();
    console.warn("Spam blockiert (Honeypot).");
    return false;
  }

  // Zeitprüfung: <3 Sekunden → Bot
  const startField = form.querySelector("#form_start_time");
  if (startField && startField.value) {
    const diff = Date.now() - parseInt(startField.value, 10);
    if (diff < 3000) {
      e.preventDefault();
      console.warn("Spam blockiert (zu schnell: " + diff + " ms)");
      return false;
    }
  }

  // Eigentliches Absenden per AJAX
  e.preventDefault();

  const statusEl = document.getElementById("form-status");
  statusEl.textContent = "Senden …";
  statusEl.style.color = "#555";

  try {
    const data = Object.fromEntries(new FormData(form).entries());

    const response = await fetch(form.action, {
      method: "POST",
      headers: {
        "Accept": "application/json",
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    });

    if (response.ok) {
      statusEl.style.color = "green";
      statusEl.textContent = "Danke! Ihre Nachricht wurde erfolgreich gesendet.";
      form.reset();

      // neuen Startwert setzen, damit erneutes Absenden nicht geblockt wird
      document.getElementById("form_start_time").value = Date.now();

    } else {
      statusEl.style.color = "red";
      statusEl.textContent = "Fehler beim Senden. Bitte später erneut versuchen.";
    }

  } catch (err) {
    statusEl.style.color = "red";
    statusEl.textContent = "Netzwerkfehler. Bitte später erneut versuchen.";
  }
}, true);
</script>
