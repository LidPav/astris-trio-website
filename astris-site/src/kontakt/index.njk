---
layout: layout.njk
title: Kontakt
description: Booking & Kontakt
---

<h1 class="h1">Kontakt</h1>
<p class="lead">Für Konzertanfragen, Programme und Pressematerial freuen wir uns über eine Nachricht.</p>

<div class="grid">

  <!-- Karte 1: Kontakt / E-Mail -->
  <div class="card">
    <h2 class="h2">Kontakt</h2>
    <p class="small">
      E‑Mail:
      mailto:{{ site.email | replace('@', '&#64;') | replace('.', '&#46;') }}?subject={{ 'Anfrage Astris Trio' | urlencode }}&amp;body={{ 'Hallo,\n\nich habe eine Anfrage.' | urlencode }}">
        {{ site.email }}
      </a>
    </p>
  </div>

  <!-- Karte 2: Kontaktformular -->
  <div class="card">
    <h2 class="h2">Kontaktformular</h2>

    https://formspree.io/f/meelkjon" data-ajax="true" accept-charset="UTF-8">

      <!-- Zeitbasierte Spam-Erkennung -->
      <input type="hidden" id="form_start_time" name="form_start_time" value="">

      <!-- Honeypot-Feld -->
      <p class="visually-hidden" aria-hidden="true">
        <label for="website">Website (leer lassen)</label>
        <input id="website" name="website" type="text" tabindex="-1" autocomplete="off" />
      </p>

      <div class="form-row">
        <label for="name">Name<span aria-hidden="true">*</span></label>
        <input id="name" name="name" type="text" required autocomplete="name" placeholder="Ihr Name" aria-required="true" />
      </div>

      <div class="form-row">
        <label for="email">E‑Mail<span aria-hidden="true">*</span></label>
        <input id="email" name="email" type="email" required autocomplete="email" placeholder="name@example.com" aria-required="true" />
      </div>

      <div class="form-row">
        <label for="subject">Betreff</label>
        <input id="subject" name="subject" type="text" placeholder="Betreff (optional)" />
      </div>

      <div class="form-row">
        <label for="message">Nachricht<span aria-hidden="true">*</span></label>
        <textarea id="message" name="message" rows="6" required placeholder="Ihre Nachricht" aria-required="true"></textarea>
      </div>

      <input type="hidden" name="_subject" value="Kontakt Astris Trio" />
      <input type="hidden" name="_language" value="de" />

      <button type="submit" class="btn">Nachricht senden</button>

      <!-- Inline-Status -->
      <p id="form-status" class="small" role="status" aria-live="polite" style="margin-top:.5rem;"></p>

      <p class="form-privacy small">
        Mit dem Absenden stimmen Sie zu, dass wir Ihre Angaben zur Beantwortung Ihrer Anfrage verarbeiten.
        Details in unserer <a href="/datenschutz/">Datenschutzerklärung</a>.
      </p>

    </form>
  </div>

</div> <!-- /grid -->


<!-- JAVASCRIPT: AJAX + Honeypot + Zeitprüfung -->
<script>
// Zeitstempel setzen, wenn Seite geladen ist
window.addEventListener("DOMContentLoaded", function () {
  const startField = document.getElementById("form_start_time");
  if (startField) startField.value = Date.now();
});

// AJAX + Spam-Checks
document.addEventListener("submit", async function (e) {
  const form = e.target;

  if (!form.matches('form[data-ajax="true"]')) return;

  if (!form.checkValidity()) return;

  e.preventDefault();

  const statusEl = document.getElementById("form-status");

  // Honeypot
  const honeypot = form.querySelector('input[name="website"]');
  if (honeypot && honeypot.value) {
    statusEl.style.color = "red";
    statusEl.textContent = "Spam erkannt.";
    return false;
  }

  // Zeitprüfung
  const startField = form.querySelector("#form_start_time");
  if (startField && startField.value) {
    const diff = Date.now() - parseInt(startField.value, 10);
    if (diff < 3000) {
      statusEl.style.color = "red";
      statusEl.textContent = "Verdächtig schnelles Absenden blockiert.";
      return false;
    }
  }

  statusEl.style.color = "#555";
  statusEl.textContent = "Senden …";

  // AJAX an Formspree
  try {
    const data = Object.fromEntries(new FormData(form).entries());

    const response = await fetch(form.action, {
      method: "POST",
      headers: {
        "Accept": "application/json",
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    });

    if (response.ok) {
      statusEl.style.color = "green";
      statusEl.textContent = "Danke! Ihre Nachricht wurde erfolgreich gesendet.";
      form.reset();
      startField.value = Date.now();
    } else {
      statusEl.style.color = "red";
      statusEl.textContent = "Fehler beim Senden. Bitte später erneut versuchen.";
    }

  } catch (err) {
    statusEl.style.color = "red";
    statusEl.textContent = "Netzwerkfehler. Bitte später erneut versuchen.";
  }

}, true);
</script>
